(function(){const _campaignIdMatcher=/cms.crocobet.com\/campaigns\/(.+)\/user/i;const _getPrizeMatcher=/cms.crocobet.com\/campaigns\/(.+)\/get-prize/i;const _storageKey="campaigns_testing_widget_state";const _campaignData=new Map;const _rootId="campaigns-testing__widget";const _idSelectorClass="campaigns-testing__id-selector";const _prizeSelectorClass="campaigns-testing__prize-selector";const _pointsInputClass="campaigns-testing__points-input";const _pointsSetButtonClass="campaigns-testing__points-set-button";const _deleteProgressButtonClass="campaigns-testing__delete-progress-button";function saveStateInLocalStorage(){const saveObj={};_campaignData.forEach((value,key)=>{saveObj[key]=value.state});localStorage.setItem(_storageKey,JSON.stringify(saveObj))}function loadStateFromLocalStorage(){const stateObj=JSON.parse(localStorage.getItem(_storageKey)||"{}");for(const key of Object.keys(stateObj)){if(_campaignData.has(key)){_campaignData.get(key).state=stateObj[key]}}}function getUserSession(){const cookies=document.cookie.split(";").map(kv=>kv.split("=")).reduce((acc,kv)=>({...acc,[kv[0].trim().toLowerCase()]:kv[1]}),{});return cookies["x-odds-session"]}function processNewCampaignId(id){const xhr=new window.XMLHttpRequest;xhr.open("GET","https://cms.crocobet.com/campaigns/"+id);xhr.send();xhr.onload=function(){if(xhr.status===200){const response=JSON.parse(xhr.response);if(response&&response.data){const releaseStage=response.data.releaseStage;if(["testing","staging"].indexOf(releaseStage)!==-1){_campaignData.get(id).info=response.data;renderUi();return}}}_campaignData.delete(id)}}function setUserPoints(id,points){const session=getUserSession();if(session){return fetch("https://cms.crocobet.com/campaigns/"+id+"/user",{method:"PATCH",headers:{"x-odds-session":session,"content-type":"application/json; charset=utf-8"},body:JSON.stringify({points:points})})}else{return Promise.resolve()}}function deleteUserProgress(id){const session=getUserSession();if(session){const promises=[];_campaignData.forEach((value,key)=>{promises.push(fetch("https://cms.crocobet.com/campaigns/"+key+"/user",{method:"DELETE",headers:{"x-odds-session":session}}))});return Promise.all(promises)}else{return Promise.resolve()}}let selectedId;function renderUi(){let rootEl=document.querySelector("#"+_rootId);if(!rootEl){rootEl=document.createElement("div");rootEl.setAttribute("id",_rootId);rootEl.innerHTML=`
      <style>
      #${_rootId} {
        position: fixed;
        z-index: 1000;
        top: 12px;
        right: 12px;
        width: 160px;
        padding: 6px;
        border: 1px solid black;
        border-radius: 4px;
        font-size: .8rem;
        transition: all 200ms;
        background-color: #fff;
        color: #000;
      }
      #${_rootId}:focus-within {
        box-shadow: 0px 0px 10px 1px rgba(0, 0, 0, 0.5);
      }
      </style>
      <div>
        <span>აქცია</span>
        <select style="width: 100%" class="${_idSelectorClass}"></select>
      </div>
      <div style="margin-top: 6px">
        <select style="width: 100%" class="${_prizeSelectorClass}"></select>
      </div>
      <div>
        <span>ქულა</span>
        <div style="display: flex">
          <input style="width: 100%" class="${_pointsInputClass}" placeholder="points"/>
          <button style="margin-left: 6px" class="${_pointsSetButtonClass}" type="button">განახლება</button>
        </div>
      </div>
      <div style="margin-top: 6px">
        <button style="width: 100%" class="${_deleteProgressButtonClass}" type="button">
          პროგრესის წაშლა
        </button>
      </div>
    `;document.body.appendChild(rootEl);const idSelectorEl=rootEl.querySelector("."+_idSelectorClass);idSelectorEl.addEventListener("change",event=>{selectedId=event.target.value;onCampaignSelectorChange(rootEl,selectedId)});const prizeSelectorEl=rootEl.querySelector("."+_prizeSelectorClass);prizeSelectorEl.addEventListener("change",event=>{const prizeId=parseInt(event.target.value,10);if(isFinite(prizeId)){_campaignData.get(selectedId).state.prizeId=prizeId;saveStateInLocalStorage()}});const pointsInputEl=rootEl.querySelector("."+_pointsInputClass);const pointsSetButtonEl=rootEl.querySelector("."+_pointsSetButtonClass);pointsSetButtonEl.addEventListener("click",()=>{const value=parseInt(pointsInputEl.value,10);if(isFinite(value)){setUserPoints(selectedId,value).then(()=>window.location.reload())}});const deleteProgressButtonEl=rootEl.querySelector("."+_deleteProgressButtonClass);deleteProgressButtonEl.addEventListener("click",()=>{deleteUserProgress(selectedId).then(()=>window.location.reload())})}loadStateFromLocalStorage();const idSelectorEl=rootEl.querySelector("."+_idSelectorClass);idSelectorEl.innerHTML="";_campaignData.forEach((value,key)=>{if(value.info&&value.user){if(!selectedId)selectedId=key;const optionEl=document.createElement("option");optionEl.setAttribute("value",key);optionEl.innerHTML=value.info.name;idSelectorEl.appendChild(optionEl)}});if(idSelectorEl.childNodes.length>0){onCampaignSelectorChange(rootEl,selectedId)}else{document.body.removeChild(rootEl);selectedId=undefined}}function onCampaignSelectorChange(rootEl,id){const data=_campaignData.get(id);const prizeSelectorEl=rootEl.querySelector("."+_prizeSelectorClass);prizeSelectorEl.innerHTML="<option>შემდეგი პრიზი</option>";data.info.prizes.forEach(prize=>{const optionEl=document.createElement("option");optionEl.setAttribute("value",prize.id);optionEl.innerHTML=`${prize.id}. ${prize.amount} ${prize.type}`;prizeSelectorEl.appendChild(optionEl)});if(data.state.prizeId){prizeSelectorEl.value=data.state.prizeId}const pointsEl=rootEl.querySelector("."+_pointsInputClass);pointsEl.value=_campaignData.get(id).user.metadata.points}function interceptXhr(){const _originalXhrOpen=window.XMLHttpRequest.prototype.open;const _originalXhrSend=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.open=function(method,url,async,user,password){const match=_campaignIdMatcher.exec(url);if(match){const id=match[1];if(!_campaignData.has(id)){_campaignData.set(id,{state:{}});this.addEventListener("load",function(){const response=JSON.parse(this.response);if(response&&response.data){_campaignData.get(id).user=response.data;processNewCampaignId(id);renderUi()}})}}this._url=url;return _originalXhrOpen.apply(this,arguments)};window.XMLHttpRequest.prototype.send=function(body){const match=_getPrizeMatcher.exec(this._url);if(match){const id=match[1];if(_campaignData.has(id)){const data=_campaignData.get(id);if(data.state.prizeId){const parsedBody=JSON.parse(body||"{}");parsedBody.prizeId=data.state.prizeId;body=JSON.stringify(parsedBody);this.setRequestHeader("content-type","application/json; charset=utf-8");setTimeout(()=>{data.state.prizeId=0;saveStateInLocalStorage();renderUi()})}}}return _originalXhrSend.apply(this,arguments)}}function interceptFetchApi(){const _originalFetch=window.fetch;window.fetch=function(url,options={}){const method=options.method||"GET";const matchUser=_campaignIdMatcher.exec(url);const matchGetPrize=_getPrizeMatcher.exec(url);if(matchUser&&method==="GET"){const id=matchUser[1];if(!_campaignData.has(id)){_campaignData.set(id,{state:{}})}return new Promise((resolve,reject)=>{_originalFetch.apply(this,arguments).then(response=>{response.clone().json().then(json=>{_campaignData.get(id).user=json.data;processNewCampaignId(id);renderUi()});resolve(response)}).catch(reject)})}else if(matchGetPrize&&method==="POST"){const id=matchGetPrize[1];if(_campaignData.has(id)){const data=_campaignData.get(id);if(data.state.prizeId){const parsedBody=JSON.parse(options.body||"{}");parsedBody.prizeId=data.state.prizeId;options.body=JSON.stringify(parsedBody);options.headers=options.headers||{};if(options.headers instanceof Headers){options.headers.set("content-type","application/json; charset=utf-8")}else{options.headers["content-type"]="application/json; charset=utf-8"}setTimeout(()=>{data.state.prizeId=0;saveStateInLocalStorage();renderUi()})}}}return _originalFetch.apply(this,arguments)}}interceptXhr();interceptFetchApi()})();const terms=$(".accordion_item_trigger-t");$(document).ready(function(){$(terms).append("<img class='arow' src='images/wheel/arow.png' alt=''>");let arrow=$(".arow");arrow.first().css("margin-right","27px");arrow.last().css("margin-right","27px");$(".owl-carousel").owlCarousel({loop:true,nav:true,dots:false,margin:10,items:7,responsiveClass:true,responsive:{0:{items:3,nav:true,autoWidth:false},400:{items:4,nav:true},800:{items:5,nav:false,autoWidth:false},1e3:{items:7,nav:true}}})});$(terms).click(function(){$(this).children(".arow").toggleClass("rotateThatBitch")});$(".owl-next").click(function(){$("button.owl-next").trigger("click")});$(".owl-prev").click(function(){$("button.owl-prev").trigger("click")});